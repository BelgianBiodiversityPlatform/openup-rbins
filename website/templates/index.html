{% extends "base.html" %}

{% load webdesign nn_tag_cloud %}

{% block content %}

<div class="row">
  <div class="span7 offset1">
    <div class="row">
      <h1>Introduction</h1>
      <p class="lea">{% lorem %}</p>
      {#  RBINS logo ? #}
    </div>

    <div class="row">    
      <h1>Browse pictures by family</h1>

      {% simple_tag_cloud families count_pictures 10 45 log %}

      <div id="tag_cloud" class="well">
        {% for family in families %}
        <a 
          class="tag-cloud-entry" 
          style="font-size: {{ family.tag_size }}px; margin: {{ family.tag_size }}px;" 
          title="{{ family.count_pictures }} picture{{ family.count_pictures|pluralize }}" 
          href="{% url website-search-view %}?family_id={{ family.id }}">
            {{ family.name }}
        </a> 
        {% endfor %}
      </div>

    </div>

    <div class="row">
      <h1>Search pictures</h1>
      
      <form class="form-horizontal">
        <fieldset>
          <legend>Taxonomy</legend>
          
          <div class="control-group">
            <label class="control-label" for="family">Family</label>
            <div class="controls"><select id="family"><option>AAA</option></select></select></div>
          </div>
          
          <div class="control-group">
            <label class="control-label" for="subfamily">SubFamily</label>
            <div class="controls"><select id="subfamily"><option>BBB</option></select></select></div>
          </div>
          
          <div class="control-group">
            <label class="control-label" for="genus">Genus</label>
            <div class="controls"><select id="genus"><option>CCC</option></select></select></div>
          </div>
          
          <div class="control-group">
            <label class="control-label" for="sn">Scientific name contains</label>
            <div class="controls"><input type="text" id="sn"></div>
          </div>
          
          <div class="form-actions">
            <button id="submit_search" type="submit" class="btn btn-primary">Search</button>
          </div>  
        </fieldset>
      </form> 
      
      
    </div>

  </div>  

  <div class="span3">
    <div id="about_box" class="well">
      <h1>About</h1>
      <p><span class="badge badge-success">{{ metrics.pictures }}</span> pictures</p>
      <p><span class="badge badge-warning">{{ metrics.families }}</span> families</p>
      <p><span class="badge badge-important">{{ metrics.species }}</span> species</p>

      {# TODO: Implement last update features... how ? #}
      <p>Last updated on {% now "jS o\f F" %}</p>
      <p><a href="#">View data on Europeana</a></p>
      <p><a href="#">View data on GBIF</a></p>
    </div>
  </div>
</div>

{% endblock %}


{% block additional_js %}
<script type="text/javascript">
  $(function(){
  
   $('.tag-cloud-entry').tooltip();
    
   $('#submit_search').click(function() {
     var url;
     var filters = {};
    // TODO: better code ?
    // TODO: trim / urlencode values ? 
     
     if($('#sn').val() !== "") {
       filters.sn_contains = $('#sn').val();
     }   
     
     url = "{% url website-search-view %}" + "?" + $.param(filters);
     
     window.location.href = url;
     
     return false;
   });
   
   
  });

</script>
{% endblock %}  