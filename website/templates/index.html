{% extends "base.html" %}

{% load webdesign django_nuages_tag %}

{% block content %}

<div class="row">
  <div class="span7 offset1">
    <div class="row">
      <h1>Introduction</h1>
      <p class="lea">{% lorem %}</p>
      {#  RBINS logo ? #}
    </div>

    <div class="row">    
      <h1>Browse pictures by family</h1>

      {% compute_tag_cloud families count_pictures font_size 10 55 log %}
      {% compute_tag_cloud families count_pictures margin 5 28 log %}
      {% compute_tag_cloud families count_pictures opacity 0.7 1 log %}

      <div id="tag_cloud">
        {% for family in families %}
        <a 
          class="tag-cloud-entry" 
          style="font-size: {{ family.font_size }}px; margin: {{ family.margin }}px; opacity: {{ family.opacity }}" 
            title="{{ family.count_pictures }} picture{{ family.count_pictures|pluralize }}" 
          href="{% url website-search-view %}?family_id={{ family.id }}">
            {{ family.name }}
        </a> 
        {% endfor %}
      </div>

    </div>

    <div class="row">
      <h1>Search pictures</h1>
      
      <form class="form-horizontal">
        <fieldset>
          
          <div class="control-group">
            <label class="control-label" for="family">Family</label>
            <div class="controls"><select id="family"><option>AAA</option></select></select></div>
          </div>
          
          <div class="control-group">
            <label class="control-label" for="subfamily">SubFamily</label>
            <div class="controls"><select id="subfamily"><option>BBB</option></select></select></div>
          </div>
          
          <div class="control-group">
            <label class="control-label" for="genus">Genus</label>
            <div class="controls"><select id="genus"><option>CCC</option></select></select></div>
          </div>
          
          <div class="control-group">
            <label class="control-label" for="sn">Scientific name contains</label>
            <div class="controls"><input type="text" id="sn"></div>
          </div>
          
          <div class="form-actions">
            <button id="submit_search" type="submit" class="btn btn-primary">Search</button>
          </div>  
        </fieldset>
      </form> 
      
      
    </div>

  </div>  

  <div class="span3">
    <div id="about_box" class="well">
      <h1>About</h1>

      <table>
        <tr><td><span class="badge badge-success">{{ metrics.pictures }}</span></td> <td>pictures</td></tr>
        <tr><td><span class="badge badge-warning">{{ metrics.families }}</span></td> <td>families</td></tr>
        <tr><td><span class="badge badge-important">{{ metrics.species }}</span></td> <td>species</td></tr>
      </table>  

      <p><a href="#">Explore data on Europeana</a></p>
      <p><a href="#">Explore data on GBIF</a></p>
      
      {# TODO: Implement last update features... how ? #}
      <p>Last updated on {% now "jS F o" %}</p>
    </div>
  </div>
</div>

{% endblock %}


{% block additional_js %}
<script type="text/javascript">
  $(function(){
  
   $('.tag-cloud-entry').tooltip();
    
   $('#submit_search').click(function() {
     var url;
     var filters = {};
    // TODO: better code ?
    // TODO: trim / urlencode values ? 
     
     if($('#sn').val() !== "") {
       filters.sn_contains = $('#sn').val();
     }   
     
     url = "{% url website-search-view %}" + "?" + $.param(filters);
     
     window.location.href = url;
     
     return false;
   });
   
   
  });

</script>
{% endblock %}  